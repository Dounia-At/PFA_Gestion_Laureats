@model List<Utilisateur>
@section title {
  Chat
}
@section js {
   @* <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>*@
   @* <link rel="stylesheet" href="https://code.jquery.com/ui/1.13.0/themes/smoothness/jquery-ui.css" />*@
    <script src="https://code.jquery.com/ui/1.13.0/jquery-ui.min.js"></script>
   
    <script src="~/lib/jquery-ajax-unobtrusive/dist/jquery.unobtrusive-ajax.js"></script>
   
  
  
}
<div class="content-wrapper">
    <!-- Content -->

    <div class="container-xxl flex-grow-1 container-p-y">
        <div class="app-chat card overflow-hidden">
            <div class="row g-0">
                <!-- Chat -->
                <div class="col-4 app-chat-contacts app-sidebar flex-grow-0 overflow-hidden border-end"
                     id="app-chat-contacts">
                    <div class="sidebar-header">

                        <div class="chat-contact-list-item-title">
                            <h5 class="text-primary mb-0 px-4 pt-3 pb-2">Chats</h5>
                        </div>
                    </div>
                    <hr class="container-m-nx m-0" />
                    <div class="sidebar-body">

                        @if (Model != null)
                        {
                            @foreach (Utilisateur utilisateur in Model)
                            {
                                @foreach(Message msg in utilisateur.messagesEnvoyees)
                                {
                                    @if (msg.ReceiverId == ViewBag.Id )
                                    {
                                        @if (msg.Id == utilisateur.messagesEnvoyees.LastOrDefault().Id)
                                        {
                                            <ul class="list-unstyled chat-contact-list" id="chat-list">

                                                <li class="chat-contact-list-item ">
                                                    <a id="liberation" class="d-flex align-items-center" data-ajax="true" data-ajax-method="get" data-ajax-mode="replace" data-ajax-update="#affichage" asp-controller="Message" asp-action="chat" asp-route-receiverId="@utilisateur.Id">
                                                        <div class="flex-shrink-0 avatar avatar-online">
                                                            <img id="clique" src="../../assets/img/avatars/@utilisateur.Photo_Profil" alt="Avatar" class="rounded-circle" />
                                                        </div>
                                                        <div class="chat-contact-info flex-grow-1 ms-2">
                                                            <h6 class="chat-contact-name text-truncate m-0">@utilisateur.Nom @utilisateur.Prenom</h6>
                                                            <p class="chat-contact-status text-muted text-truncate mb-0">
                                                                @msg.contenu
                                                            </p>
                                                        </div>
                                                        <small class="text-muted mb-auto"> @String.Format("{0:HH:mm}", msg.Date_Envoie)</small>
                                                    </a>
                                                </li>

                                            </ul>

                                        }

                                    }
                                }
                                @*<button id="clique" data-id="@msg.ReceiverId">Envoyer</button>*@
                              
                            }                            
                        }
                        else
                        {
                            <h3>Aucun Message réçu</h3>
                        }


                    </div>
                </div>
                <!-- /Chat -->
                <div class="col-8 app-chat-history bg-body " >
                    <div class="chat-history-wrapper">
                        <div class="chat-history-header border-bottom">
                            <div class="d-flex justify-content-between align-items-center">
                                <div class="col app-chat-history bg-body">
                                    <div class="chat-history-wrapper">
                                        <div id="affichage" class="chat-history-body bg-body"></div>
                                     </div>
                                   
                               </div>
                                
                                </div>
                           </div>
                     </div>
                </div>
            </div>
        </div>
    </div>
</div>

